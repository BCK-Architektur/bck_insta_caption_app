{% extends "captionApp/base.html" %}
{% block title %}Caption Generator{% endblock title %}
{% block main %}
<div class="container mx-auto p-6">
    <h1 class="text-2xl font-bold mb-4">Generate Instagram Captions</h1>
    <div id="post-container"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    fetch("/uncaptioned/")
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById("post-container");
            data.posts.forEach(post => {
                const div = document.createElement("div");
                div.className = "p-4 border rounded mb-4";
                div.innerHTML = `
                    <div>
                        ${post.images.map(img => `<img src="${img}" class="w-32 h-32 m-2 inline-block" />`).join("")}
                    </div>
                    <button onclick="generateCaptions(${post.id})" class="btn btn-primary mt-2">Generate Captions</button>
                    <div id="captions-${post.id}" class="mt-2"></div>
                `;
                container.appendChild(div);
            });
        });
});

function generateCaptions(postId) {
    fetch(`/generate/${postId}/`)
        .then(response => response.json())
        .then(data => {
            const captionsDiv = document.getElementById(`captions-${postId}`);
            captionsDiv.innerHTML = data.captions.map(cap => `
                <button class="btn btn-secondary mt-2" onclick="saveCaption(${postId}, '${cap}')">${cap}</button>
            `).join("");
        });
}

function saveCaption(postId, caption) {
    fetch(`/save/${postId}/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ caption })
    }).then(() => location.reload());
}
</script>
{% endblock main %}
